# 6 经验

我们在2003年2月编写了MapReduce库的第一个版本，并在2003年8月对其进行了重大改进，包括地理位置优化，跨工作机器的任务执行的动态负载平衡等。从那时起，我们对MapReduce库在我们所做的问题类型中的广泛适用性感到惊喜。

它已经在Google的多个领域被广泛使用，包括：
* 大规模机器学习问题，
* 针对Google新闻和Froogle产品的聚类问题，
* 用于生成热门查询报告的数据提取（例如Google Zeitgeist），
* 用于新的实验和产品的网页属性的提取（例如，从大量网页中提取地理位置用于本地化搜索），和
* 大规模图计算。

图4显示了随着时间的推移，我们的主要源代码管理系统中单独的MapReduce程序数量的显著增长，从2003年初的0到2004年9月末的近900个单独实例。MapReduce之所以如此成功，是因为它使得写一个简单的程序并在半小时内有效地在一千台机器上运行成为可能，大大加快了开发和原型制作的周期。此外，它允许没有分布式和/或并行系统经验的程序员轻易地利用大量资源。

在每个工作任务结束时，MapReduce库会记录工作任务使用的计算资源的统计数据。在表1中，我们显示了2004年8月Google运行的一部分MapReduce作业的一些统计数据。

## 6.1 大规模索引

到目前为止，我们使用MapReduce的最重要的用途之一是彻底重写生产索引系统，该系统生成用于Google网络搜索服务的数据结构。索引系统以我们的爬行系统检索的大量文档为输入，这些文档存储为一组GFS文件。这些文档的原始内容超过20TB的数据。索引过程作为五到十个MapReduce操作的序列运行。使用MapReduce（而不是先前版本的索引系统中的特定分布式步骤）提供了几个好处：

* 索引代码更简单，更小，更容易理解，因为处理容错、分布和并行化的代码隐藏在MapReduce库中。例如，当使用MapReduce表示时，计算的一阶段的大小从大约3800行C++代码减少到大约700行。

* MapReduce库的性能足够好，我们可以保持概念上无关的计算独立，而不是混合在一起以避免对数据的额外传递。这使得更改索引过程变得容易。例如，在我们的旧索引系统中需要几个月时间进行的一项更改，在新系统中只需要几天就可以实施。

* 索引过程的操作变得更加容易，因为大多数由机器故障、缓慢的机器和网络问题引起的问题都可以由MapReduce库自动处理，无需操作员干预。此外，通过向索引集群添加新机器，可以轻松提高索引过程的性能。